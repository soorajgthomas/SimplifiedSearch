(function(){var f=Handlebars.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(f,c,e,m,g){var h,d;return'\x3cdiv class\x3d"cols-row"\x3e\n    \x3cdiv class\x3d""\x3e\n        \x3cbutton type\x3d"button" data-control\x3d"remove" data-target-id\x3d"" class\x3d"btn-primary btn-close air-attach-close" id\x3d"air-attach-close-btn"\x3e\n          \x3cspan class\x3d"icon icon-close" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n          \x3cspan class\x3d"alt"\x3eClose\x3c/span\x3e\n        \x3c/button\x3e\n        \x3ca href\x3d"'+f.escapeExpression((d=null!=(d=e.hotelSearchUrl||(null!=c?c.hotelSearchUrl:c))?d:e.helperMissing,"function"===typeof d?d.call(null!=c?c:{},{name:"hotelSearchUrl",hash:{},data:g}):d))+'" class\x3d"cf" data-onclick\x3d"xp.nav.trackAnalytics(this,\'a\',\'MIP.HOT.EXPEDIA.STOREFRONT\')"\x3e\n            \x3cspan class\x3d"air-attach-message"\x3e\n                \x3cspan class\x3d"icon icon-flights" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n                \x3cspan class\x3d"icon"\x3e+\x3c/span\x3e\n                \x3cspan class\x3d"icon icon-hotels" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n                '+(null!=(h=(d=null!=(d=e.discountMessage||(null!=c?c.discountMessage:c))?d:e.helperMissing,"function"===typeof d?d.call(null!=c?c:{},{name:"discountMessage",hash:{},data:g}):d))?h:"")+'\n            \x3c/span\x3e\n            \x3cspan class\x3d"offer-countdown"\x3e\n                \x3cspan class\x3d"icon icon-time" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n                \x3cspan class\x3d"offer-countdown-timer"\x3e\x3c/span\x3e\n            \x3c/span\x3e\n        \x3c/a\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n'},useData:!0});Handlebars.templates=Handlebars.templates||{};Handlebars.templates.airAttach=f;Handlebars.partials=Handlebars.partials||{};Handlebars.partials.airAttach=f})();(function(){var f=Handlebars.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(f,c,e,m,g){var h,d;return'\x3ca href\x3d"'+f.escapeExpression((d=null!=(d=e.hotelSearchUrl||(null!=c?c.hotelSearchUrl:c))?d:e.helperMissing,"function"===typeof d?d.call(null!=c?c:{},{name:"hotelSearchUrl",hash:{},data:g}):d))+'" class\x3d"cf" data-onclick\x3d"xp.nav.trackAnalytics(this,\'a\',\'MIP.HOT.EXPEDIA.STOREFRONT\')"\x3e\n    \x3cdiv class\x3d"uitk-grid"\x3e\n        \x3cdiv class\x3d"uitk-col all-col-shrink addon-image-container"\x3e\n            \x3cimg class\x3d"addon-image" src\x3d"//a.travel-assets.com/bundles/storefront-web/images/air-attach/add-on.svg"\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"uitk-col all-col-fill all-x-gutter-24"\x3e\n            \x3cspan class\x3d"air-attach-message"\x3e\n                '+(null!=(h=(d=null!=(d=e.oneCampaignHotelDiscountMessage||(null!=c?c.oneCampaignHotelDiscountMessage:c))?d:e.helperMissing,"function"===typeof d?d.call(null!=c?c:{},{name:"oneCampaignHotelDiscountMessage",hash:{},data:g}):d))?h:"")+"\n            \x3c/span\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n\x3c/a\x3e"},useData:!0});Handlebars.templates=Handlebars.templates||{};Handlebars.templates.airAttachOneCampaign=f;Handlebars.partials=Handlebars.partials||{};Handlebars.partials.airAttachOneCampaign=f})();define("airAttach-loc",function(){return{hotelDiscountMessage:'Your flight purchase qualifies you for up to {{g_msg_discountValue}}% off select \x3cu\x3ehotels\x3c/u\x3e for your \x3cb class\x3d"airattach-trip-cityname"\x3e{{cityname}}\x3c/b\x3e trip',mipqDiscountMessage:'Your recent booking qualifies you for up to 40% off select hotels for your \x3cb class\x3d"airattach-trip-cityname"\x3e{{cityname}}\x3c/b\x3e trip',offerExpireDays:"Offer expires in X days",offerExpireHours:'Offer expires in \x3cspan class\x3d"offer-countdown-timer"\x3ehh:mm:ss\x3c/span\x3e',oneCampaignHotelDiscountMessage:'You unlocked up to {{g_msg_discountValue}}% off hotels because you booked on \x3cb class\x3d"airattach-trip-brandname"\x3e{{brandname}}\x3c/b\x3e',oneCampaignOfferExpireDays:'Expires in X days \x3cspan class\x3d"offer-countdown-timer"\x3ehh:mm:ss\x3c/span\x3e',oneCampaignOfferExpireHours:'Expires in \x3cspan class\x3d"offer-countdown-timer"\x3ehh:mm:ss\x3c/span\x3e'}});
define("airAttachBanner","handlebars hotelSearchUrl AttachQualificationService travelerProfileModel airAttach-loc uitk uitk_localized_dateApi exp_datetimeformats bannerConsolidation oip".split(" "),function(f,h,c,e,m,g,x,d,q,v){var a=a||{},p,l=$("#airattach-container"),w=l.data("aqs-enabled"),t=l.data("one-campaign-enabled"),u=l.data("one-campaign-discount");a.init=function(){p=q.getSelectedBannerStatus();var b=e.multiItemPriceQualification,n="January February March April May June July August September October November December".split(" ");if(w)c.getQualificationsPromise().then(function(b){return a.getAqsHOTMIPQualification(b)}).then(function(b){"object"===typeof b&&(a.timer=((new Date(b.recommendation.qualification.zonedExpirationTime.dateTime.date.year,b.recommendation.qualification.zonedExpirationTime.dateTime.date.month-1,b.recommendation.qualification.zonedExpirationTime.dateTime.date.day,b.recommendation.qualification.zonedExpirationTime.dateTime.time.hour,b.recommendation.qualification.zonedExpirationTime.dateTime.time.minute,b.recommendation.qualification.zonedExpirationTime.dateTime.time.second)).getTime()-(new Date).getTime())/1E3,a.startDate=a.getFormattedDateStringFromPattern(d.dateTimeSettings[g.locale].date.format["short"],b.recommendation.searchStartDateTime),a.endDate=a.getFormattedDateStringFromPattern(d.dateTimeSettings[g.locale].date.format["short"],b.recommendation.searchEndDateTime),a.enableOfferWindowTillTravel=!1,a.destinationName=b.recommendation.regionName,a.destinationID=b.recommendation.regionId,a.showMipqBanner())});else if("object"===typeof b){var k=new Date(1E3*b.startDate.seconds),r=new Date(1E3*b.endDate.seconds);a.timer=((new Date(1E3*b.expirationDate.seconds)).getTime()-(new Date).getTime())/1E3;a.startDate=g.utils.createLocalizedDate(n[k.getMonth()]+" "+k.getDate()+" "+k.getFullYear(),g.locale).shortDate();a.endDate=g.utils.createLocalizedDate(n[r.getMonth()]+" "+r.getDate()+" "+r.getFullYear(),g.locale).shortDate();a.enableOfferWindowTillTravel=!1;a.destinationName=b.destinationName;a.destinationID=b.destinationID;a.showMipqBanner()}else $.ajax({dataType:"json",url:"/api/airattach/qualification",success:a.callback,complete:function(b,a){var n={status:a};"success"===a&&"object"===typeof b&&"string"===typeof b.responseText&&0<b.responseText.length&&-1<b.responseText.indexOf("tripID")&&(n.hasTripInfo=!0);window.dctk&&dctk.enabled&&dctk.logging&&dctk.logging.logError?dctk.logging.logMessage("sf-web:air-attach",n):require("dctk/clientLogging",function(b){b.logMessage("sf-web:air-attach",n)})},cache:!1,timeout:5E3})};a.getAqsHOTMIPQualification=function(b){for(var a in b)for(var k in b[a].recommendations)for(var d in b[a].recommendations[k].qualifications)if("HOTMIP"===b[a].recommendations[k].qualifications[d].type&&!b[a].recommendations[k].qualifications[d].expired)return{regionDisplayNames:b[a].regionDisplayNames,startDateTime:b[a].startDateTime,startLocalDateTime:b[a].startLocalDateTime,endDateTime:b[a].endDateTime,endLocalDateTime:b[a].endLocalDateTime,recommendation:{lineOfBusiness:b[a].recommendations[k].lineOfBusiness,regionId:b[a].recommendations[k].regionId,regionName:b[a].recommendations[k].regionName,searchStartDateTime:b[a].recommendations[k].searchStartDateTime,searchLocalStartDateTime:b[a].recommendations[k].searchLocalStartDateTime,searchEndDateTime:b[a].recommendations[k].searchEndDateTime,searchLocalEndDateTime:b[a].recommendations[k].searchLocalEndDateTime,qualification:b[a].recommendations[k].qualifications[d]}};return null};a.getFormattedDateStringFromPattern=function(a,d){var b=d.match(/(\d{4})-(\d{2})-(\d{2})/);var c=a.replace("yyyy",b[1]);c=/dd/.test(a)?c.replace("dd",b[3]):c.replace("d",parseInt(b[3]));return c=/MM/.test(a)?c.replace("MM",b[2]):c.replace("M",parseInt(b[2]))};a.callback=function(b){if(b&&b.qualificationWindows&&0<b.qualificationWindows.length){b=b.qualificationWindows[0];var c=b.tripInfo.finalDestinationAirportCode;a.setAirattachData(b);a.setSearchUrlAndCityName(c);if(window.dctk&&window.dctk.onReady)dctk.onReady(function(){dctk.trackAction("MIP.Hot.Shown.Storefront")});else require("dctk/dctk",function(a){a.onReady(function(){a.trackAction("MIP.Hot.Shown.Storefront")})});a.mipqBannerTracking()}};a.testBanner=function(){p=!0;a.renderBanner({hotelSearchUrl:"http://www.expedia.com",discountMessage:"Test banner for AirAtach"})};a.setAirattachData=function(b){a.timer=b.timeLeftForExpirationInMilliSecs/1E3;a.startDate=g.utils.createLocalizedDate(b.startDate,g.locale).shortDate();a.endDate=g.utils.createLocalizedDate(b.endDate,g.locale).shortDate();a.origin=b.tripInfo.originAirportCode;a.tripType=b.tripInfo.tripType;a.enableOfferWindowTillTravel=b.enableOfferWindowTillTravel};a.renderBanner=function(b){if("show"===p||!0===p)b=(t?f.partials.airAttachOneCampaign:f.partials.airAttach)(b),l.html(b),t||a.renderCountdown(),b=l.height(),l.css("height",0).animate({height:b,opacity:1},1500,function(){$(this).css("height","auto")}),$(".air-attach-close").on("click",this.closeAirAttachBanner),a.mipqBannerTracking(),a.bindEvents()};a.renderCountdown=function(){var b,c,d,f=$(".offer-countdown-timer"),g=$(".offer-countdown");var e=a.enableOfferWindowTillTravel?Math.ceil(a.timer/86400):Math.floor(a.timer/86400);if(3<=e)e=m.offerExpireDays.replace("X",e),f.html(e),g.addClass("timer-ready");else{var h=m.offerExpireHours;g.addClass("timer-ready");var l=setInterval(function(){var e=a.timer--; -1===e?(g.removeClass("timer-ready"),clearInterval(l)):(b=parseInt(e/3600,10),e%=3600,c=parseInt(e/60,10),d=parseInt(e%60,10),10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),e=h.replace("hh",b).replace("mm",c).replace("ss\x3c",d+"\x3c"),f.html(e))},1E3)}};a.showMipqBanner=function(){a.hotelSearchUrl=h({regionId:a.destinationID,rooms:[{adults:1}],startDate:a.startDate,endDate:a.endDate,isHashlessURLneeded:!0});a.renderBanner({hotelSearchUrl:a.hotelSearchUrl,discountMessage:m.mipqDiscountMessage.replace("{{cityname}}",a.destinationName),oneCampaignHotelDiscountMessage:m.oneCampaignHotelDiscountMessage.replace("{{cityname}}",a.destinationName).replace("{{g_msg_discountValue}}",u).replace("{{brandname}}",window.brand)})};a.setSearchUrlAndCityName=function(b){a.getDataFromAirportTla(b,function(b){a.regionId=b.sr[0].hierarchyInfo.airport.multicity;a.cityname=b.sr[0].regionNames.shortName.split(",")[0].replace(/(<([^>]+)>)/ig,"");a.hotelSearchUrl=h({regionId:a.regionId,rooms:[{adults:1}],startDate:"ROUND_TRIP"===a.tripType?a.startDate:"",endDate:"ROUND_TRIP"===a.tripType?a.endDate:"",isHashlessURLneeded:!0});var c={discountMessage:m.hotelDiscountMessage.replace("{{g_msg_discountValue}}",window.airAttachVal).replace("{{cityname}}",a.cityname),hotelSearchUrl:a.hotelSearchUrl,oneCampaignHotelDiscountMessage:m.oneCampaignHotelDiscountMessage.replace("{{cityname}}",a.destinationName).replace("{{g_msg_discountValue}}",u).replace("{{brandname}}",window.brand)};require(["airAttachBanner"],function(a){a.renderBanner(c)})})};a.getDataFromAirportTla=function(a,c){$.ajax({dataType:"jsonp",url:"https://suggest.expedia.com/api/v4/typeahead/"+a+"?format\x3djsonp\x26client\x3dHomepage\x26regiontype\x3d1\x26maxresults\x3d1\x26lob\x3dFLIGHTS\x26locale\x3d"+locale,success:c,timeout:5E3})};a.mipqBannerTracking=function(){require("dctk/dctk",function(a){a.onReady(function(){a.trackEvent({trackEvents:"event132,event152"})})})};a.bindEvents=function(){$("#air-attach-close-btn").on("click",function(){v.canTrack&&a.setCloseCookie()})};a.closeAirAttachBanner=function(){q.hasStarted&&q.setNextBanner();l.css("opacity",1).animate({opacity:0},{duration:600,complete:function(){l.addClass("hidden")}})};a.isCloseCookieSet=function(){return 0<=document.cookie.indexOf("MIPBClose")};a.setCloseCookie=function(){var a=new Date;a.setTime(a.getTime()+864E5);document.cookie="MIPBClose\x3dyes; expires\x3d"+a.toGMTString()};return a});
require(["airAttachBanner"],function(f){if(f.isCloseCookieSet()){var h={message:"Close cookie is set"};window.dctk&&dctk.enabled&&dctk.logging&&dctk.logging.logError?dctk.logging.logMessage("sf-web:air-attach",h):require("dctk/clientLogging",function(c){c.logMessage("sf-web:air-attach",h)})}else f.init()});require(["jquery","uitk"],function(f,h){function c(){f(document).on(h.clickEvent,"#airattach-container",function(){if(window.dctk&&window.dctk.onReady)dctk.onReady(function(){dctk.trackAction("MIP.Hot.Click.Storefront")});else require("dctk/dctk",function(c){c.onReady(function(){c.trackAction("MIP.Hot.Click.Storefront")})})})}f(function(){c()})});var test={};
//# sourceMappingURL=airAttachBanner-1-en_US.js.map